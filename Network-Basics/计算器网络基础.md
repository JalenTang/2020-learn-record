# 计算器网络基础

## TCP/IP

- TCP：传输控制协议（Transmission Control Protocol）
- IP：网际协议（Internet Protocol）

## HTTP

- HTTP：超文本传输​​协议（Hypertext Transfer Protoco），一个用于分布式、协作式和超媒体信息系统的**应用层**协议
- HTTP 基于 TCP/IP 通信协议来传输数据，是一个标准的**B/S（brower浏览器/server服务端）**模型，HTTP协议总是由HTTP客户端向HTTP服务端发起请求
- 主要特点：
    1. 简单快捷：客户端向服务器请求服务时，只需传送请求方法和路径
    2. 灵活：HTTP允许传输任意类型的数据对象，类型由 `Content-Type` 加以标记
    3. 短连接/长连接/管道化/多路复用：
       - HTTP/0.9时代：**短连接**，即每次HTTP请求都要经历一次DNS解析，TCP连接
       - HTTP/1.0时代：提出**持久连接**，即一次TCP连接服务多个请求，客户端通过添加请求头`Connection: Keep-Alive`向服务器请求持久连接；如果服务器支持持久连接，会在响应头里返回`Connection: Keep-Alive`，默认参数是`{timeout=5, max=100}`, 即一个TCP连接可以服务至多5秒内的100次请求
       - HTTP/1.1时代：默认持久连接，不需要在请求头中携带`Connection: Keep-Alive`；并且提出**pipelining**概念来试图解决**HOLB（Head of Line Blocking）**问题，即客户端可以在一个请求发送完成后不等待响应便直接发起第二个请求，服务端在返回响应时会按请求到达的顺序依次返回；但管道化并没有彻底解决HOLB，为了让同一个连接中的多个响应能够和多个请求匹配上，响应仍然是按请求的顺序串行返回的
       - HTTP/2时代，
         - **多路复用multiplexing**，即让多个请求和响应的传输完全混杂在一起进行，通过`streamId`来互相区别，同时还允许给每个请求设置优先级，服务端会先响应优先级高的请求
         - **HPACK算法**，即对HTTP头部字段做数据压缩
    4. 无状态（stateless）：对于发送过的请求和响应都不做持久化处理，但是可以通过**Cookies/Session**来实现有状态的会话

### HTTP报文

- 请求报文
  1. 由**请求行**、**请求头**、**空行**和**请求体**组成
  2. 请求行包括**请求方法**、**请求URL**和**HTTP/版本号**

- 响应报文
  1. 由**响应行**、**响应头**、**空行**和**响应体**组成
  2. 响应行包括**HTTP/版本号**、**状态码**和**状态码描述**
  
- 常见的头部字段:
  1. `Accept-Encoding:gzip/compress/deflate/identity(默认)`, 表示客户端支持的内容编码格式，可取值：
  2. `Authorization`：表示客户端的认证信息，一般和JWT连用
  3. `Access-Control-Allow-Methods`：指定客户端访问允许使用的方法或方法列表
  4. `Access-Control-Allow-Origin`：指定响应的资源是否被允许与给定的origin共享，设置为`*`来允许跨域
  5. `Access-Control-Max-Age`：指定预检请求preflight request的返回结果可以被缓存的时间，值为-1表示禁用缓存
  6. `ETag`：表示资源的特定版本的标识符，不同的资源对应不用的ETag值，便于高效化浏览器缓存机制
  7. `If-None-Match`：指定上次服务器返回的资源的标识符，请求头携带此字段，服务器根据该值判断资源是否发生改变
  8. `Expires：<http-date>`，指定请求过期的日期/时间，如：`Expires: Wed, 21 Oct 2020 07:28:00 GMT`;
  9. `Cache-Control：no-cache/no-store/public/private/max-age=<>`，HTTP/1.1的新增字段，用于判断浏览器缓存控制规则，优先级高于Expires
  10. `Last-Modified`：指定源头服务器认定的资源做出修改的日期及时间，如：`Last-Modified: Wed, 21 Oct 2020 07:28:00 GMT`
  11. `If-Modified-Since`：浏览器再次请求资源时携带的时间值，服务器根据该值判断是否返回新的资源，只在 `GET` 和 `HEAD` 方法中有效
  12. Keep-Alive：
  13. User-Agent：保护浏览器和代理名称等信息
  14. Set-Cookie
  15. Cookie：

### HTTP请求方法

1. GET
2. POST
3. PUT
4. DELETE
5. OPTIONS
6. TRACE
7. CONNECT

### HTTP状态码

1. 1xx:
2. 2xx:
3. 3xx:
4. 4xx:
5. 5xx:

### 浏览器缓存机制

#### 浏览器缓存：重用已获取的资源，减少延迟与网络阻塞，有利于提升网站与应用的性能  

#### 浏览器缓存过程：![浏览器缓存机制](../images/network-cache.png)

- 当浏览器发起一个请求：
  - 是否存在本地缓存，
    - 不存在：直接发起请求
    - 存在：根据**强缓存策略**判断是否过期：
      - 未过期：直接载入缓存资源
      - 已过期：根据**协商缓存策略**判断缓存是否有效，
        - 有效：则返回304状态码，载入缓存资源
        - 无效：重新请求服务器

1. 强缓存相关字段：
  
   - `Expires`：**HTTP/1.0**的字段，弃置为服务器返回请求过期的时间，表示在该时间之前，本地缓存始终有效

   - `Cache-Control`：**HTTP/1.1**的字段，优先级高于`Expires`，可选的值有：
     - `no-cache`: 需要进行协商缓存
     - `no-store`: 禁止使用缓存，不存储任务内容
     - `public`：可以被所有的用户缓存，包括终端用户和 CDN 等中间代理服务器
     - `private`：只能被单个用户缓存，不能作为共享缓存
     - `max-age=<seconds>`：缓存到期的最大周期（相对时间），超过该事件则任务过期
     - `s-maxage=<seconds>`：覆盖max-age或者Expires头

   - **注意点**：由于`Expires`时间返回的是服务器绝对时间，而客户端本地时间是可以修改的，因此会造成时间的误差和不同步，而`Cache-Control:max-age=<seconds>`返回的是参照客户端第一次请求的相对时间，因此不会受到影响

2. 协商缓存相关字段：
   - 第一组： `Last-Modified` 和 `If-Modify-Since`，浏览器第一次请求服务器资源时，服务器会在响应头内设置`Last-Modified`字段，表示该资源最后修改的时间；浏览器第二次请求资源时，会在请求头内设置`If-Modify-Since`，其值为上一次的`Last-Modified`值，服务器收到`If-Modify-Since`的值后，比服务器资源的`Last-Modified`作比较，
     - 如果无变化则返回`304`，不返回资源，不返回`Last-Modified`值，浏览器接收`304`后使用本地缓存
     - 如果有变化，则返回`200`，返回新资源，返回新的`Last-Modified`值

   - 第二组：`ETag` 和 `If-None-Match`，浏览器第一次请求服务器资源时，服务器会在响应头内设置`ETag`字段，其值表示该资源的唯一标识符；浏览器第二次请求资源时，会在请求头内设置`If-None-Match`，其值为上一次响应头的`ETag`值，服务器收到`If-None-Match`的值后，与服务器资源的`ETag`作比较:
     - 如果两者一致，则说明资源未发生改变，返回`304`，不返回资源，**返回`ETag`值（即使未变化）**，浏览器接收`304`后使用本地缓存
     - 如果两者不一致，则说明资源发生改变，返回`200`，返回新资源，返回资源新的`ETag`值
  
   - **注意点**：上述两者是可以一起使用的，但是 `ETag` 的优先级高于 `Last-Modified`，`ETag` 一致的情况下，再比对`Last-Modified`
      - `ETag` 解决了某些时候，文件未发生改变，但是修改时间发生改变而不需要重新返回新资源的问题
      - `If-Modified-Since`是秒级的，对于频繁修改的文件识别不准确，比如某个资源1s内修改了多次

### HTTP和HTTPS

### 参考文章

1. [HTTP 维基百科](https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE)
2. [MDN HTTP Headers全解](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers)
3. [浏览器缓存](https://juejin.im/post/5c4528a6f265da611a4822cc#heading-18)
4. [HTTP 和 HTTPS](https://juejin.im/post/5af557a3f265da0b9265a498#heading-14)

## Cookies/Session/Token/JWT的区别

## 跨域
